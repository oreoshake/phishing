(function(b){function a(d,c){this.init(d,c)}a.prototype.init=function(e,d){var c=this;this.data=null;this.settings={videoId:null,debug:(window.location.search.indexOf("debug=1")>-1||window.location.search.indexOf("debug=true")>-1),triggerStart:false,afterInit:function(i,h){},countViews:true,showTitleWithPlaceholder:false};b.extend(this.settings,d);if(this.settings.videoId==null){var g=b(e).data("video-id");var f=parseInt(g,10);if(isNaN(f)){c.debug("no video ID");return false}this.settings.videoId=f}b.ajax({type:"GET",url:"/apps/video/details",data:{v:this.settings.videoId},dataType:"json"}).done(function(h){if(h.success===true){c.debug(h);this.data=h.video;c.insertVideo(b(e),this.data)}else{c.debug("failure on server")}})};a.prototype.debug=function(d){if(this.settings.debug&&window.console){try{window.console.log(d)}catch(c){}}};a.prototype.insertVideo=function(g,j){var q=this;var n='<video id="video_placeholder" class="video-js vjs-default-skin vjs-big-play-centered" preload="none">';var f="</video>";if(navigator.appVersion.indexOf("MSIE 7.")!=-1){if(j.versions.length>2){var i=j.versions[j.versions.length-2]["url"]}else{var i=j.versions[0]["url"]}g.html('<p class="unsupported">:( Sorry, you are using an unsupported browser. You can download the video here: <a style="color: #fff" href="'+i+'">download</a></p>');return}var l=g.height();var d=l;var p=g.width();var h=(j.isAudio===true);this.aspectRatio=j.versions[0].width/j.versions[0].height;if(!h){var d=g.width()/this.aspectRatio}else{d=360}if(d>l){d=l}g.height(d);this.singleVideo=k(j,h,this.settings.showTitleWithPlaceholder);if(h){g.append(n+o(this.singleVideo)+f)}else{g.append(n+e(this.singleVideo)+f)}var r={controls:true,height:d,width:p,poster:this.singleVideo.image,plugins:{resolutionSelector:{default_res:"360"}}};this.myPlayer=videojs("video_placeholder",r);var m;if(this.settings.showTitleWithPlaceholder){m='<div class="vjs-info-bar vjs-control-bar"><a href="/apps/video/watch.jsp?v='+j.videoId+'" target="_top">'+this.singleVideo.title+"</a></div>"}else{m="<div></div>"}b("#video_placeholder").append(m);if(this.settings.triggerStart==true){this.myPlayer.load();this.myPlayer.play()}var c=document.fullscreenEnabled||document.mozFullScreenEnabled||document.webkitFullscreenEnabled;this.myPlayer.on("fullscreenchange",function(){if(c){return}var s=$parent.parents();var t=[];if(this.isFullscreen()){s.each(function(u,v){var w=b(v).css("z-index");t[u]=w;if(w!=="auto"){b(v).css("z-index",2147483647)}})}else{s.each(function(v,w){var u=t[v];if(u!=="auto"){b(w).css("z-index",u)}})}});if(q.settings.countViews===true){q._initializeViewCounting(q.myPlayer)}if(b("#go_hd").length>0){q._initializeHDButton(q.myPlayer)}q.settings.afterInit.call(q,j,q.myPlayer);function k(v,w,u){var s={};if(!w){var x=v.placeholders.PH720;if(!x){x=v.placeholders.PH360}if(!x){x=v.placeholders.THUMB}s={image:x,sources:t()}}else{s={image:"/apps/pics/headphones_big.jpg",sources:[{file:v.versions[0].url,label:v.versions[0].height}]}}if(u){s.title=v.title}return s;function t(){var y=new Array();b.each(v.versions,function(A,z){var B={file:z.url,label:z.height};if(z.height==360){B["default"]=true}y.push(B)});return y}}function e(s){var t="";b.each(s.sources,function(u,v){t+='<source src="'+v.file+'" type="video/mp4" data-res="'+v.label+'" />\n'});return t}function o(s){var t="";b.each(s.sources,function(u,v){t+='<source src="'+v.file+'" type="video/mp4" />'});return t}};a.prototype._initializeViewCounting=function(f){var h=this;var g=0,c=30,d=false,e=true;f.refreshIntervalId=setInterval(function(){if(!e&&!d&&!f.paused()){var i=f.duration();if(i>0&&(0.65*i)<c){c=i*0.65}h.debug("threshold: "+c);g++;if(g>c){h.incrementCount();d=true}h.debug("view count check "+g)}},1000);f.on("firstplay",function(){e=false})};a.prototype._initializeHDButton=function(d){var g=this;if(d.getResolutionsCount()<2){return}var c=true;d.on("firstplay",function(){if(c){if(b("#go_hd").length>0){if(d.getCurrentRes()==d.getHighestRes()){f()}b("#go_hd").show()}c=false}});d.on("changeRes",function(){if(d.getCurrentRes()==d.getHighestRes()){f()}else{e()}});b("#go_hd").on("click",function(h){d.trigger("changeToHd");h.preventDefault();if(b(this).hasClass("in-hd-mode")){if(d.hasDefaultRes()){d.trigger("changeToDefaultRes")}else{d.trigger("changeToLowestRes")}e()}else{d.trigger("changeToHighestRes");f()}});function f(){b("#go_hd").addClass("in-hd-mode");b("#go_hd").html("Go to standard definition")}function e(){b("#go_hd").html('Go <span class="hd-logo">HD</span>');b("#go_hd").removeClass("in-hd-mode")}};a.prototype.incrementCount=function(){var c=this;b.ajax({type:"POST",url:"/apps/video/increment",data:{v:this.settings.videoId},dataType:"json"}).done(function(d){if(d.success!==true){c.debug("Something went wrong incrementing")}})};a.prototype.changeDimensions=function(f,e){var d=b(f);var c=e.height;if(!c||isNaN(parseInt(c,10))){c=e.width/this.aspectRatio}d.height(c);this.myPlayer.height(c);this.myPlayer.width(e.width)};a.prototype.getCurrentVideoData=function(c){return this.data};b.fn.videoInitialize=function(c,d){return this.each(function(){var e=this;if(typeof c==="string"){var g=b.data(this,"videoInitialize");var f=g[c];if(c.charAt(0)!=="_"&&typeof f==="function"){f.call(g,this,d)}}else{b.data(this,"videoInitialize",new a(this,c))}})}})((typeof jq18=="function")?jq18:jQuery);